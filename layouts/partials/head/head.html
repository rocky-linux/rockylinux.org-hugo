<title>{{ .Title }}</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

{{ $styles := resources.Get "css/main.css" }}
{{ $styles = $styles | resources.PostCSS (dict "inlineImports" true) }}

{{ $styles = $styles | minify }}
<link href="{{ $styles.Permalink }}" rel="stylesheet" />

<link href="https://fonts.googleapis.com/css?family=Red+Hat+Display:400,400italic,500,500italic,700,700italic,900,900italic" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Red+Hat+Text:400,400italic,500,500italic,700,700italic" rel="stylesheet" type="text/css" />
<link rel="icon" href="/img/favicon.ico"/>

<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.3.5/dist/alpine.min.js" defer=""></script>

{{ partial "meta/site-twittercard.html" . }}

<!-- This is the script in charge of redirecting the page if it is not in the correct language -->
<script>
// If no language has been defined by the GET method, we save it as preferred in a cookie.
if(getParameterByName("l") != "") {

    // We define all available languages
    var languages = ["pt-BR", "pt-PT", "es", "tr", "en", "nl", "it", "de", "ru", "lv", "zh", "ja"]

    // We see if the language passed by the get exists in the array
    if(languages.includes( getParameterByName("l") )) {
        // We delete the previous preferred language
        document.cookie = "preferredLanguage=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";

        // We save new language
        document.cookie = "preferredLanguage="+getParameterByName("l");
    }
}    

if (getCookie("preferredLanguage")) {
    // If we have a favorite language, it is the one we will use
    var language = getCookie("preferredLanguage");
    var languageWCountry = getCookie("preferredLanguage");
}else{
    // If we don't get it from the browser
    var language = (navigator.language || navigator.userLanguage).substr(0, 2);
    var languageWCountry = (navigator.language || navigator.userLanguage);
}

// We check that the site is in the correct language, and if it is not, we redirect
// VERY IMPORTANT. ALWAYS PUT UP THE LANGUAGES THAT HAVE FORMAT xx-YY AND BELOW THOSE THAT HAVE FORMAT xx
if('{{ i18n "language" . }}' != language) {
    if (languageWCountry == "pt-BR") {
        window.location.href = "pt-BR/"
        document.cookie = "preferredLanguage=pt-BR"
    } else if (languageWCountry == "pt-PT") {
        window.location.href = "pt-PT/"
        document.cookie = "preferredLanguage=pt-PT"
    } else if (language == "es") {
        window.location.href = "es/"
        document.cookie = "preferredLanguage=es"
    } else if (language == "it") {
        window.location.href = "it/"
        document.cookie = "preferredLanguage=it"
    } else if (language == "de") {
        window.location.href = "de/"
        document.cookie = "preferredLanguage=de"
    } else if (language == "nl") {
        window.location.href = "nl/"
        document.cookie = "preferredLanguage=nl"
    } else if (language == "tr") {
        window.location.href = "tr/"
        document.cookie = "preferredLanguage=tr"
    } else if (language == "ru") {
        window.location.href = "ru/"
        document.cookie = "preferredLanguage=ru"
    } else if (language == "de") {
        window.location.href = "de/"
        document.cookie = "preferredLanguage=de"
    } else if (language == "lv") {
        window.location.href = "lv/"
        document.cookie = "preferredLanguage=lv"
    } else if (language == "zh") {
        window.location.href = "zh/"
        document.cookie = "preferredLanguage=zh"
    } else if (language == "ja") {
        window.location.href = "ja/"
        document.cookie = "preferredLanguage=ja"
    } else  { //Default to english
        document.cookie = "preferredLanguage=en"
    }
}

function getCookie(name) {
   const value = `; ${document.cookie}`;
   const parts = value.split(`; ${name}=`);
   if (parts.length === 2) return parts.pop().split(';').shift();
}

function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
    results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}
</script>